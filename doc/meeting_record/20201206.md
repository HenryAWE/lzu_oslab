**与会人员**：

​    孔俊 俞腾飞



**主要内容**：

- 讨论 RISC-V 中断处理
- 讨论进程的虚拟地址空间
- 讨论项目的构建方式
- 讨论 Lab 1 要完善的地方



**中断处理**：

​    使用统一的分派函数进行中断处理。RISC-V 中中断处理有向量模式，可以向 x86 那样通过中断向量表调用中断处理函数，但异常不支持向量模式。为了简化、统一中断和异常的处理，不再使用向量模式，通过统一的分派函数根据中断、异常类型调用对应的处理函数。



**虚拟地址空间**：

​    Linux 0.12 最多管理 16 M 内存，进程虚拟地址空间大小为 64 M，每个进程占据 N * 64 M 到 (N+1) * 64 M 的线性地址空间，整个系统共用一个页目录。Linux 0.12 有意让虚拟地址空间大于物理内存空间，并将进程 0 的线性地址空间设置为 0 到 64 M，因此用户进程一定不会修改线性地址 0 ~ 64 M 的映射（线性地址等于物理地址），在内核态下，线性地址等于物理地址。

RISC-V 版同样采用 x86 版的思路，让内核态下线性地址等于物理地址。RISC-V 管理 128 M 物理内存，每个进程虚拟地址空间大小为 128 M，占据线性地址空间 N * 128 M 到 (N+1)  * 128 M。物理地址从 0x8000_0000 开始，但 0x1000_0000 到 0x1001_0000(内存映射 IO, 设备段内存区)同样需要内核管理，最后系统线性地址空间布局如下：

```
    |  OpenSBI  |     内核、设备段内存区域（进程 0)  |    进程 1    |    ...    |    进程 N    |
    ^           ^                                ^                         ^              
    |           |                                |                         |              
0x8000_0000 0x8200_0000                  0x8000_0000 + 128M         0x8000_0000 + N * 128M   
```

0x8200_0000 到 0x8000_0000 + 64 M 作为内核区域，前端存放内核，尾部映射设备段内存区域。这段区域中，除了尾部的设备内存区域被映射到物理地址 0x1000_0000 到 0x1001_0000，其他部分线性地址被映射为等于物理地址。物理内存 0x8000_0000 到 0x8200_0000 被 OpenSBI 占据，不参与物理内存分配，尾部 0x001_0000 字节的物理内存也不参与分配。



**项目的构建**：

​    基本保留 x86 版本的项目结构。x86 版本中 Makefile 里手写了大量依赖，在 RISC-V 版本中所有目录（除了 main.c)都编译为静态库，供其他目录的代码调用，避免手写依赖。

​    每个实验单独存放在一个目录中，后面的实验目录是前面的实验目录的超集。

​    因为有很多代码需要改写，为了避免风格不统一，最后用代码格式化工具格式化为统一的风格。注释安装 Doxygen 格式写，方便生成 API 文档。



**Lab 1 要完善的地方**：

- 实验指导书添加 GDB 的使用介绍

  



